# STEP 1: CREATE HISTOGRAM (Dependent Variable Only) WITH FREQUENCY


cat("STEP 1: Checking for Normal Distribution\n")


# Calculate mean and standard deviation for normal curve
mean_rating <- mean(data_clean$avg_vote_cleaned)
sd_rating <- sd(data_clean$avg_vote_cleaned)

# Create histogram with FREQUENCY on y-axis and normal distribution curve
# Calculate bin width for the histogram
bin_width <- (max(data_clean$avg_vote_cleaned) - min(data_clean$avg_vote_cleaned)) / 30

p_histogram <- ggplot(data_clean, aes(x = avg_vote_cleaned)) +
  geom_histogram(bins = 30, fill = "#2E86AB", alpha = 0.7, color = "white") +
  stat_function(
    fun = function(x) dnorm(x, mean = mean_rating, sd = sd_rating) * nrow(data_clean) * bin_width,
    color = "red", 
    size = 1.5, 
    linetype = "solid"
  ) +
  labs(
    title = "Histogram: Average IMDb Rating Distribution",
    subtitle = "Blue bars = Observed data | Red curve = Theoretical distribution",
    x = "Average IMDb Rating (rating score)",
    y = "Frequency",
    caption = paste0("Mean = ", round(mean_rating, 2), 
                     " | SD = ", round(sd_rating, 2),
                     " | n = ", nrow(data_clean),
                     " | Years: 2002-2019 | Budget â‰¤ $50M")
  ) +
  theme_classic(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "gray30", size = 11, hjust = 0),
    panel.border = element_rect(fill = NA, color = "black", size = 1),
    axis.line = element_blank(),
    plot.caption = element_text(hjust = 0, color = "gray50")
  )

# Save histogram with ULTRA HIGH resolution
dir.create("correlation_plots", showWarnings = FALSE)
ggsave("correlation_plots/1_histogram.png", p_histogram, 
       width = 16, height = 10, dpi = 600, bg = "white")
